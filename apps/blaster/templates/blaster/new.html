{% extends "blaster/base.html" %}

{% block javascripts %}
<script type="text/javascript">
// TODO: clean all these javascripts
function toggle(source) {
  checkboxes = document.getElementsByName('foo');
  for each(var checkbox in checkboxes)
    checkbox.checked = source.checked;
}

function last_choice(selection) {
  return selection.selectedIndex==selection.length - 1; }

function valid(menu,txt) {
  if(menu.selectedIndex == 0) {
    alert('You must make a selection from the menu');
    return false;} 
  if(txt.value == '') {
    if(last_choice(menu)) {
      alert('You need to type your choice into the text box');
      return false; }
    else {
      return true; }}
  else {
    if(!last_choice(menu)) {
      alert('Incompatible selection');
      return false; }
    else {
      return true; }}}

function activate(field) {
  field.disabled=false;
  if(document.styleSheets)field.style.visibility  = 'visible';
  field.focus(); }

function process_choice(selection,textfield) {
  if(last_choice(selection)) {
    activate(textfield); }
  else {
    textfield.disabled = true;    
    if(document.styleSheets) {
        // textfield.style.visibility  = 'hidden';
    }
    textfield.value = ''; }}

function check_choice() {
  if(!last_choice(document.mainform.message)) {
    document.mainform.choicetext.blur();
    alert('Please check your menu selection first');
    document.mainform.message.focus(); }}
    
    
function toggle(name, value) {
  checkboxes = document.getElementsByName(name);
  for each(var checkbox in checkboxes)
    checkbox.checked = value;
}

</script>
{% endblock %}

{% block content %}
<h1>
	<a href="">Question Sender</a>
	/ <a href="">New Question</a>
</h1>




<h2>New Question</h2>
<br>
{% if errors %}
<p><span class="error">{{ errors|safe }}</p>
{% endif %}
<form name="mainform" method="post">
Choose an existing question: 
<select name="message" onchange="process_choice(this,document.mainform.new_question)"  >
    <option value="">(Please Select)</option>
    {% for message in messages %}
     <option value="{{message.id}}">{{message.text}}</option>
     {% endfor %}
     <option value="new">== New Question ==</option>
</select>
<p>New Question Text: <input type="text" name="new_question" maxlength="160" style="width:500px;" disabled="true"/></p>
Select: <span class="js_link" onclick="toggle('select_reporter', true)">All</span>, <span class="js_link" onclick="toggle('select_reporter', false)">None</span>  
        
<table>
    <thead>
        <th>Send?</th>
        <th>Person</th>
        <th>School</th>
        <th>Role(s)</th>
    </thead>
    <tbody>
    {% for reporter in reporters %}
        <tr>
            <td>
                <input type="checkbox" name="select_reporter" id="{{reporter.id}}" value="{{reporter.id}}"/>
            </td>
            <td>{{ reporter }}</td>
            <td>{{ reporter.school }}</td>
            <td>{{ reporter.school_role }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<input type="submit" value="Send" />
</form>
{% endblock %}
